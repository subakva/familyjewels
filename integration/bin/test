#! /usr/bin/env ruby
$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', '..', 'lib'))

require 'family_jewels'
require 'fileutils'

FileUtils.rm_rf('tmp/integration')

config = FamilyJewels::Config.new(
  :gems_dir  => File.join(ENV['PWD'], 'tmp/integration/gems_dir'),
  :stage_dir => File.join(ENV['PWD'], 'tmp/integration/stage_dir'),
  :verbose   => true
)

config.register(
	:verbose 	  		=> true,
	:clone_url    	=> 'git@github.com:subakva/familyjewels-test.git'
)

config.register(
  :verbose        => true,
  :clone_url      => 'git@github.com:subakva/familyjewels-test.git',
  :branch_name    => 'experiment'
)

config.register(
  :verbose        => true,
  :clone_url      => 'git@github.com:subakva/familyjewels-test.git',
  :branch_name    => 'no-bundler',
  :dependencies   => {'jeweler', '1.6.4'}
)

config.all.each do |project|
  project.build
end

system("bundle exec rspec -I integration integration/family_jewels_spec.rb")
exit $?.exitstatus
